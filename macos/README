# Setup new machine from scratch

## manual installations
chrome

## rsync files
clean up old home directory, check for anything new to exclude, then:
`./.dotfiles/macos/sync_new_cp.sh`
~/Library/Application\ Support/Exodus
~/Library/Application\ Support/Duplicati

## settings
keyboard->modifer keys->caps-lock = ctrl
sound->play sound on startup off

## get home dir files
`git clone git@gitlab.com:takezo/home.git`
`mv home/.* ~/`
`rm -r home/`

## setup with dotfiles
With my user as admin user (to ensure homebrew can be installed), clone dotfiles repo and:
`./.dotfiles/script/bootstrap`

## brew install
Change my user to standard user. Now we only install homebrew packages as user admin.
`chown -R admin:staff /usr/local/*`
`su admin`
`brew bundle --file homebrew/Brewfile`  

## mail backup
In Mail App:
link google account
Download attachments: all

## time machine (AFTER rsync)

June 2021:
Only excluded:
    `~/Desktop` 
    `~/Downloads` 
    `~/temp`
    `~/Library/Application Support/Steam`
    `~/Documents/Encypted/prviate`
    `~/Documents/Encypted/prviate.gpg`
Included all system directories for easy restore. I held down Cmd-Shift when selecting 
exclusions, which gave an option to see hidden directories, but /usr (Homebrew) was 
grayed out so didn't exclude it.

Earlier:

```
sudo tmutil inheritbackup /Volumes/DISKNAME/Backups.backupdb/COMPUTERNAME
sudo tmutil setdestination /Volumes/DISKNAME
sudo tmutil associatedisk -a / /Volumes/DISKNAME/Backups.backupdb/COMPUTERNAME/Latest/Macintosh\ HD
```
better to manually set exclusions while viewing old exclusions since there is 
no obvious way to dump these. There is an option to show hidden files during 
exclusion. Best to exclude repo `.git` and data folders, `Desktop`, `Downloads`
`temp`; drag `/System` to exclude all system files; `/usr` to ensure homebrew
files are not backed up.

## duplicati (AFTER rsync)
On old machine turn off duplicati on startup: Users & Groups -> Login Items
copy `~/.config/Duplicati` to new machine and open duplicati.

# Setup machine from time machine backup
You don't back up system files so don't do system restore:  
- use migration assistant to restore files and computer settings
- `./.dotfiles/bootstrap`
- `brew bundle --file homebrew/Brewfile`  
- git clone hwpl (since data/ and .git are not backed up)  
- set iterm shell to ...

## keychain
I didn't do this for new setup in June 2021 but you can:
```
scp ~/Library/Keychains/login.keychain-db NEWCP:~/Library/Keychains/oldlogin.keychain-db
```
then in keychain app; `file->Add Keychain`; drag and drop anything you want to keep.




