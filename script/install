#!/usr/bin/env bash
#
# Run all dotfiles installers.

pprint intro 'Running installers'

# Clean logs
find -L /tmp -maxdepth 1 -name *.dot.log | while read logfile; do rm "${logfile}"; done

# find the installers and run them iteratively
for installer in `find $ZSH -maxdepth 2 -name install.sh`; do
  topic=`basename $(dirname ${installer})`
  pprint info "Installing $topic"
  sh -c "${installer}"
  pprint flush

  if [[ $? == 1 ]]; then
    errors=true
  fi
done

if [[ "$errors" == true ]]; then
  pprint fail "There were some errors. Check the logfiles:"
  find -L /tmp -maxdepth 1 -name *.dot.log | while read logfile; do pprint error "${logfile}"; done
else
  pprint success "Everything installed like a charm!"
fi

pprint flush
exit 0
