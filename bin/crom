#!/bin/bash -ex

mkdir -p build
cd build
update=""
if [ $# -eq 1 ]; then
  update="--update"
fi

profile_switch=${CROM_DEFAULT_PROFILE:+-pr $CROM_DEFAULT_PROFILE}

conan install $update $profile_switch -s build_type=Debug --build=outdated ..
if [[ -f ../conanfile.py ]]; then
  CONAN_CMAKE_GENERATOR=Ninja conan build -c ..
else
  cmake -G Ninja ..
fi
